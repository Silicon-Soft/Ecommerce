@using Microsoft.AspNetCore.Identity
@using Ecommerce.Models
@using Ecommerce.Services.Interface
@using Ecommerce.ViewModel
@inject ICartService cartservice
@inject ICart_ItemsService cart_temservice
@inject ICategoryService categoryservice
@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager
@{
    bool isAdmin = false;
    bool isUser = false;
    if (SignInManager.IsSignedIn(User))
    {
        var user = await UserManager.GetUserAsync(User);
        if (user != null)
        {
            isAdmin = await UserManager.IsInRoleAsync(user, "Admin");
            isUser = await UserManager.IsInRoleAsync(user, "User");

        }
    }
    List<ViewCategoryVM> viewCategoryVMs = categoryservice.GetCategories();
}

@{
    ViewData["Title"] = "Home Page";
}
@model IEnumerable<ViewProductVM>
<div class="">
<div class="text-center" >
    <div class="d-flex justify-content-between" >
        <div></div>
        <form  method="get" class="d-flex w-100 justify-content-center mt-3">
            <input class="form-control mr-sm-2 w-50" type="search" placeholder="Search By ProductName" aria-label="Search" name="searching">
            <button class="btn btn-outline-success my-2 my-sm-0 ms-5 " type="submit" >Search</button>
        </form>
       
        
             <a class="mt-2" asp-controller="Cart" asp-action="ViewCart" asp-route-userid="@UserManager.GetUserId(User)">

                <button class="cart-button position-relative mx-4 p-2 btn border rounded-circle px-3">
                <span class="position-absolute">
                @cart_temservice.getCartItemQuantity(UserManager.GetUserId(User))
                
                </span>
            <img src="~/Product/cart.svg"/>
            </button>
            </a>
      
        
        
     </div>
</div>
<div id="carouselExampleControls" class="carousel">
    <div class="carousel-inner">

            @if(Model.Count()==0)
            {
               <h1>No Match Found:</h1>
            }
        
             else 
             {
             @foreach (var obj in Model)
            {

                    <div class="carousel-item active ">
                <div class="card">
                    <div class="img-wrapper"><img src="@Url.Content($"~/Product/{obj.imageLink}")" class="d-block " alt="..."> </div>
                        
                        <a id="productDetailLink" asp-controller="Home" asp-action="ProductDetail" asp-route-id="@obj.ProductID" class="text-decoration-none">
                        <div class="card-body bg-gradient" style="cursor:pointer;" onclick="redirectToProductDetail()">
                    
                    <h5 class="card-title">@obj.ProductName</h5>
                    
                            @if (obj.ProductDescription.Length > 40)
                            {
                                <p class="card-text w-10 text-black ">
                                  @obj.ProductDescription.Substring(0,20)..........     
                                </p>
                            }
                            else
                            {
                                <p class="card-text w-10">
                                    @obj.ProductDescription
                                </p>

                                
                            }

                    <div class="d-flex">
                    <p class="text-decorastion-underline text-success">Prize:@obj.SellPrice</p>
                   

                    </div>
                     


                </div>
                </a>
            </div>
            </div>
             
            }
            }
        
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
       
            
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>
<div class="productbyid ">
        
    <div class="row mx-2 mb-4">
            <ul class="list-unstyled d-flex">
                @foreach (var category in viewCategoryVMs)
                {
                    
                        
                        <ul class="list-unstyled">
                            @foreach (var obj in Model.Where(p => p.CategoryId == category.CategoryId).OrderBy(p => p.ProductID))
                            {
                                <li class="border border-1 bg-white mx-2">
                                <div class="d-flex flex-column align-items-center container">
                                        <p class="text-black text-center fw-normal fs-3 mx-3 mt-2"> Explore @category.CategoryName <br />Items</p>
                                        <img width="280" height="280" src="@Url.Content($"~/Product/{obj.imageLink}")" alt="@obj.ProductName" class="product-image container" />
                                        <a asp-controller="Home" asp-action="ProductByCategory" asp-route-categoryId="@category.CategoryId" class="getmore btn text-decoration-none text-primary"> Get More</a>
                                    </div>
                            </li>
                            break;
                        }
                        </ul>
                        
                    
                }
            </ul>

        </div>
</div>

</div>
<style>
    .getmore :hover{
        transform: scale(1.2);
        text-decoration:underline;
    }
    .productbyid
    {
        
       background-color: rgb(245, 245, 245);
    }
</style>

